import ee
import ee.mapclient

if __name__ == '__main__':
    ee.Initialize()
    
    collection = ee.ImageCollection('LANDSAT/LC8_L1T_8DAY_RAW').filterDate('2000-04-01', '2017-07-01');
    median = collection.median();

    geometry = [[[27.58660650083459,53.79519588797124], [27.6017089086464,53.79971560977351], [27.59278856652361,53.82994332748849], [27.67074997465852,53.83573823971719], [27.671973291004406,53.807003672830305], [27.70347253320847,53.804791711239], [27.739119932135395,53.8422990190259], [27.67472242808185,53.91124607282209], [27.768733361646696,53.96283653603087], [27.699658150151436,53.966821652074536], [27.638822669223714,53.96269314647609], [27.532698915414812,53.98743241281526], [27.510370534298545,53.94670879103335], [27.39493220262375,53.93777454483563], [27.392571176651927,53.88613900909335], [27.358420859880994,53.8696438118693], [27.402464608059972,53.83831808116393], [27.424462511674278,53.840075339526514], [27.443009828174127,53.82758110676454], [27.461551660835767,53.808604497038345], [27.515489125318254,53.81023270598164], [27.536522888342688,53.8116485859007], [27.564433753675303,53.82846418424909], [27.58660650083459,53.79519588797124]]]
    fc = ee.FeatureCollection(ee.Geometry.Polygon(geometry));
    clipped = median.clipToCollection(fc);

    result = clipped.select('B8')
    print(result.getDownloadURL({
      'scale': 5,
      'crs': 'EPSG:4326',
      'region': str(geometry[0])
    }
    ));
    # ee.mapclient.addLayer(result);
    # ee.mapclient.setCenter(27.56, 53.9, 10);
